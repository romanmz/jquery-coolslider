// coolslider v2.0 - http://github.com/romanmz/coolslider
(function(e,t,n){function u(){var e=document.createElement("p"),r,i={webkitTransform:"-webkit-transform",OTransform:"-o-transform",msTransform:"-ms-transform",MozTransform:"-moz-transform",transform:"transform"};document.body.insertBefore(e,null);for(var s in i){if(e.style[s]!==n){e.style[s]="translate3d(1px,1px,1px)";r=t.getComputedStyle(e).getPropertyValue(i[s])}}document.body.removeChild(e);return r!==n&&r.length>0&&r!=="none"}function a(){var e=document.createElement("p").style;var t="transition"in e||"WebkitTransition"in e||"MozTransition"in e||"msTransition"in e||"OTransition"in e;return t}var r="coolslider";var i=r+"Backup";var s=r+"Classname";var o={type:"scroll",swipe:true,slides:"> *",timer:8e3,speed:500,showFirst:1,loop:false,autoplay:false,keyboard:true,fixHeight:false,classSelected:"selected",classAutoplaying:"autoplaying",classTransitioning:"transitioning",classDisabled:"disabled",prev:"",next:"",play:"",stop:"",links:"",linksTitle:"",current:"",total:""};t.CoolSlider=function(t,n){this.slider=e(t);if(typeof n=="object")this.init(n)};e.fn[r]=function(t){return this.each(function(){if(!e(this).data(r)){e(this).data(r,new CoolSlider(this,t))}})};e.fn[r].defaults=o;CoolSlider.prototype={init:function(i){if(this.data){return this}var s=this,f=s.slider;var l={};e.each(e.fn[r].defaults,function(e,t){var n=r.toLowerCase()+"-"+e;if(f.data(n))l[e]=f.data(n)});i=s.settings=e.extend({},e.fn[r].defaults,i?i:this.settings,l);var c=s.slides=f.find(i.slides);if(c.length<2){return this}var h=s.data={total:c.length,selected:n,previous:n,loopDirection:0,isMoving:false,isPlaying:i.autoplay,timerChange:false,timerTransition:false,timerFixHeight:false,speed:i.speed,isTouch:i.swipe&&("ontouchstart"in t||navigator.msMaxTouchPoints>0),hasTransforms3D:typeof Modernizr!="undefined"&&Modernizr.csstransforms3d||u(),hasTransitions:typeof Modernizr!="undefined"&&Modernizr.csstransitions||a()};var p=h.isTouch&&i.swipe!==true?i.swipe:i.type;if(typeof p==="string"&&typeof e.fn[r].effects[p]==="function"){p=e.fn[r].effects[p]}else if(typeof p!=="function"){p=e.fn[r].effects[o.type]}s._initEvents();s._initTouchEvents();s._initControls();p.call(s,f,c,i,h);f.trigger("init");s.goTo(i.showFirst=="random"?Math.floor(Math.random()*h.total):i.showFirst-1,0);return this},destroy:function(){var n=this,o=n.settings,u=n.data,a=n.slider,f=n.slides,l=n.controls;a.trigger("destroy").off("touchstart."+r+" "+"touchmove."+r+" "+"touchend."+r+" slidestart."+r+" slideend."+r+" "+"destroy."+r).removeData(r);if(o){a.removeClass(o.classTransitioning+" "+o.classAutoplaying)}if(n.wrapper&&n.wrapper.data(i)){f.unwrap()}if(f){f.height("").each(function(){e(this).removeClass(e(this).data(s)).removeData(s)})}if(l){l.prev.removeClass(o.classDisabled).off("click."+r);l.next.removeClass(o.classDisabled).off("click."+r);l.play.removeClass(o.classAutoplaying).off("click."+r);l.stop.removeClass(o.classAutoplaying).off("click."+r);l.current.html(l.current.data(i)).removeData(i);l.total.html(l.total.data(i)).removeData(i);l.links.each(function(t){var n=e(this);if(n.data(i)===true)n.remove();else n.find(o.linksTitle).html(n.data(i));n.removeClass(n.data(s)).removeData(i+" "+s)}).off("click."+r)}if(u){clearTimeout(u.timerTransition);clearTimeout(u.timerChange);clearTimeout(u.timerFixHeight)}e(document).off("keydown."+r);e(t).off("load."+r+" "+"resize."+r);delete n.wrapper;delete n.slides;delete n.controls;delete n.data;delete n.touchData;return this},_initEvents:function(){var n=this,i=n.settings,s=n.data,o=n.slider,u=n.slides;if(i.keyboard){e(document).on("keydown."+r,function(e){var t=e.which;if(t==37)n.previous();else if(t==39)n.next()})}if(i.fixHeight){function a(){if(!n.data)return;var t=0;u.height("").each(function(){t=Math.max(t,e(this).height())}).height(t);s.timerFixHeight=setTimeout(a,1e3)}a();e(t).on("load."+r+" "+"resize."+r,a);if(typeof e.fn.imagesLoaded=="function"){u.imagesLoaded().progress(a)}}return this},_initTouchEvents:function(){if(!this.data.isTouch||this.touchData){return}var e=this,t=e.settings,n=e.data,i=e.slider,s=e.slides;var o=e.touchData={};i.on("touchstart."+r,function(e){var t=e.originalEvent.touches[0];o.startX=t.pageX;o.startY=t.pageY;o.startTime=+(new Date);o.areaWidth=i.innerWidth();o.areaHeight=i.innerHeight();o.deltaX=0;o.deltaY=0;o.ratioX=0;o.ratioY=0;o.directionX=0;o.directionY=0;o.direction="";o.swipedX=false;o.swipedY=false}).on("touchmove."+r,function(e){e=e.originalEvent;if(e.touches.length>1||e.scale&&e.scale!==1){return}o.deltaX=e.touches[0].pageX-o.startX;o.deltaY=e.touches[0].pageY-o.startY;o.ratioX=o.deltaX/o.areaWidth;o.ratioY=o.deltaY/o.areaHeight;o.directionX=o.deltaX<0?1:-1;o.directionY=o.deltaY<0?1:-1;if(!o.direction)o.direction=Math.abs(o.deltaY)>Math.abs(o.deltaX)?"y":"x"}).on("touchend."+r,function(e){var t=+(new Date)-o.startTime<250;if(o.direction=="x"){var n=Math.abs(o.deltaX)>20;var r=Math.abs(o.ratioX)>.5;o.swipedX=r||t&&n}else{var n=Math.abs(o.deltaY)>20;var r=Math.abs(o.ratioY)>.5;o.swipedY=r||t&&n}});return this},_initControls:function(){if(this.controls){return this}var t=this,n=t.settings,s=t.data,o=t.slider,u=t.slides;var a=t.controls=e();a.prev=e(n.prev);a.next=e(n.next);a.play=e(n.play);a.stop=e(n.stop);a.current=e(n.current);a.total=e(n.total);a.links=e(n.links);if(s.isPlaying){a.play.addClass(n.classAutoplaying);a.stop.addClass(n.classAutoplaying)}a.current.data(i,a.current.html());a.total.data(i,a.total.html());for(var f=0;f<s.total;f++){var l=a.links.eq(f);if(l.length){l.data(i,l.find(n.linksTitle).html())}else{l=a.links.last().clone().insertAfter(a.links.last()).removeData("slide-title");a.links=a.links.add(l);l.data(i,true)}var c=u.eq(f).data("slide-title");if(!c)c=f+1;l.find(n.linksTitle).text(c)}o.on("slidestart."+r,function(){t.updateControls()});a.prev.on("click."+r,function(e){t.previous();e.preventDefault()});a.next.on("click."+r,function(e){t.next();e.preventDefault()});a.play.on("click."+r,function(e){t.play();e.preventDefault()});a.stop.on("click."+r,function(e){t.stop();e.preventDefault()});a.links.on("click."+r,function(n){s.loopDirection=0;t.goTo(a.links.index(e(this)));n.preventDefault()});return this},updateControls:function(){var e=this,t=e.settings,n=e.data,r=e.slider,i=e.controls;var s=t.loop||n.selected>0?"removeClass":"addClass";i.prev[s](t.classDisabled);var o=t.loop||n.selected<n.total-1?"removeClass":"addClass";i.next[o](t.classDisabled);var u=n.isPlaying?"addClass":"removeClass";i.play[u](t.classAutoplaying);i.stop[u](t.classAutoplaying);r[u](t.classAutoplaying);e._updateClasses(i.links);i.current.text(n.selected+1);i.total.text(n.total);return this},_limitRange:function(e){var t=this.data.total-1;var n=this.settings.loop;return e>t?n?0:t:e<0?n?t:0:e},_getWrapper:function(){if(!this.wrapper){var t=this.slides.parent();if(t.is(this.slider)||t.length>1){var n=e("<div>").data(i,true);this.slides.wrapAll(n)}this.wrapper=this.slides.parent()}return this.wrapper},_updateClasses:function(t,n){var r=this;if(typeof n==="undefined")n=0;t.each(function(t){var i=r.data.selected+n;var o=t-i==0?"":t-i;var u=r.settings.classSelected+o;e(this).removeClass(e(this).data(s)).addClass(u).data(s,u)});return this},goTo:function(e,t,r){var i=this,s=i.settings,o=i.data,u=i.slider,a=i.slides,f=i.controls;if(typeof t==="undefined")t=s.speed;if(typeof r==="undefined")r=false;e=i._limitRange(e);if(!r&&(o.isMoving||e==o.selected)){return this}o.isMoving=true;o.previous=o.selected>=0&&o.selected!=e?o.selected:n;o.selected=e;o.speed=t;if(o.loopDirection==0){o.loopDirection=o.selected-o.previous>0?1:-1}clearTimeout(o.timerChange);clearTimeout(o.timerTransition);i._updateClasses(a);u.addClass(s.classTransitioning);u.trigger("slidestart");o.timerTransition=setTimeout(function(){o.isMoving=false;if(o.isPlaying)i.play();u.removeClass(s.classTransitioning);u.trigger("slideend")},o.speed);return this},previous:function(){this.data.loopDirection=-1;this.goTo(this.data.selected-1);return this},next:function(){this.data.loopDirection=1;this.goTo(this.data.selected+1);return this},stop:function(){this.data.isPlaying=false;this.updateControls();this.goTo(this.data.selected,0,true);return this},play:function(){var e=this,t=e.data;t.isPlaying=true;e.updateControls();clearTimeout(t.timerChange);t.timerChange=setTimeout(function(){var n=t.selected+1>t.total-1?0:t.selected+1;t.loopDirection=1;e.goTo(n)},e.settings.timer);return this}};e.fn[r].effects={css:function(e,t,n,r){},tabs:function(e,t,n,i){e.on("slidestart."+r,function(){t.hide().eq(i.selected).show()}).on("destroy."+r,function(){t.css({display:""})})},fade:function(t,n,i,s){function c(e,t,r,i){n.stop(true,true);if(!e.not(t).length)return;if(i==0){e.css({opacity:r});t.not(e).css({opacity:1-r})}else{e.fadeTo(i,r);l=setTimeout(function(){t.not(e).fadeTo(i/2,1-r)},i/2)}}var o=this,u=o.touchData;var a=o._getWrapper();var f=100/s.total;var l;t.css({overflow:"hidden"});a.css({position:"relative",left:0,top:0,width:s.total*100+"%"});n.css({position:"relative","float":"left",width:f+"%",zIndex:0,opacity:0,visibility:"hidden"}).each(function(t){e(this).css({left:f*-t+"%"})});t.on("slidestart."+r,function(){var e=n.eq(s.selected);e.css({visibility:"visible",zIndex:1});c(e,n.eq(s.previous),1,s.speed)}).on("slideend."+r,function(){var e=n.eq(s.selected);e.css({zIndex:0});n.not(e).css({zIndex:0,visibility:"hidden",opacity:0})});if(s.isTouch){t.on("touchstart."+r,function(){o.stop()}).on("touchmove."+r,function(e){e=e.originalEvent;if(u.direction=="x"){var t=n.eq(s.selected);var r=n.eq(o._limitRange(s.selected+u.directionX));var i=1-u.ratioX*-u.directionX;r.css({visibility:"visible",zIndex:1});c(t,r,i,0);e.preventDefault()}}).on("touchend."+r,function(){if(u.swipedX){o.goTo(s.selected+u.directionX,i.speed,true)}else if(u.direction=="x"){o.goTo(s.selected,i.speed,true)}})}t.on("destroy."+r,function(){clearTimeout(l);t.css({overflow:""});a.css({position:"",left:"",top:"",width:""});n.stop(true,true).css({position:"","float":"",width:"",zIndex:"",opacity:"",visibility:"",left:""})})},scroll:function(t,n,i,s){function m(e,t){var n;if(s.hasTransforms3D&&s.hasTransitions){n=e/l*-100+"%";var r=s.isTouch?"translate3d("+n+",0,0)":"translateX("+n+")";a.css({transform:r,"transition-duration":t+"ms"})}else{n=e*-100+"%";a.stop(true,true).animate({left:n},{duration:t})}}var o=this,u=o.touchData;var a=o._getWrapper();var f=n;var l=f.length;var c=false;var h=i.loop&&!s.isTouch;var p=e();var d=e();var v=1;if(h){p=n.clone().prependTo(a);d=n.clone().appendTo(a);f=f.add(p).add(d);l=f.length}if(t.css("position")=="static")t.css("position","relative");a.css({position:"relative",left:0,top:0,overflow:"hidden",width:l*100+"%"});f.css({"float":"left",width:(100/l).toFixed(2)+"%"});t.on("slidestart."+r,function(){var e=s.selected;c=false;if(h){e+=s.total;if((s.selected-s.previous)*s.loopDirection<0){e+=s.total*s.loopDirection;c=true}var t=s.total;if(c)t+=s.total*s.loopDirection;o._updateClasses(f,t)}m(e,s.speed)}).on("slideend."+r,function(){if(h&&c){var e=s.selected+s.total;m(e,0);o._updateClasses(f,s.total)}});if(s.isTouch){t.on("touchstart."+r,function(){o.stop();v=1}).on("touchmove."+r,function(e){e=e.originalEvent;if(u.direction=="x"){if(s.selected<=0&&u.deltaX>0||s.selected>=s.total-1&&u.deltaX<0){v=Math.abs(u.deltaX)/u.areaWidth+2}var t=s.selected+u.ratioX/-v;m(t,0);e.preventDefault()}}).on("touchend."+r,function(){if(u.swipedX){o.goTo(s.selected+u.directionX,i.speed,true)}else if(u.direction=="x"){m(s.selected,i.speed)}})}t.on("destroy."+r,function(){p.add(d).remove();t.css({position:""});a.stop(true,true).css({position:"",left:"",top:"",overflow:"",width:"",transform:"",transitionDuration:""});n.css({"float":"",width:""})})}}})(jQuery,window);